---
title: "IO"
description: "An overview of C# I/O operations, covering file and directory manipulation, stream-based processing for efficient data handling, and HTTP client usage for web requests."
status: 'Live'
flavor: 'Deck'
---



# IO

---

### Goals

1. Explain the difference between `File` and `FileInfo`
2. Explain the difference between `Directory` and `DirectoryInfo`
2. Describe the benefits of using streams to process files
4. Describe how to make HTTP requests using `HttpClient` (Optional)

---

### Roadmap

1. Files
2. Streams
3. HttpClient (Optional)

---




## Files

---

### Overview
* `System.IO` namespace is straightforward
* Methods for creating, copying, deleting, moving, and opening files
* Two flavors:
  - [`System.IO.File`](https://learn.microsoft.com/en-us/dotnet/api/system.io.file) has static methods
  - [`System.IO.FileInfo`](https://learn.microsoft.com/en-us/dotnet/api/system.io.fileinfo) has instance methods

---

### Example: Read a file

```csharp
// Static method on `File`
var contentsA = File.ReadAllText("file.txt");
Console.WriteLine(contentsA);

// Instance method on `FileInfo`
var info = new FileInfo("file.txt");
var contentsB = info.ReadAllText();
Console.WriteLine(contentsB);

```

---

### Example: Write a file

```csharp
public class FileLogger
{
    private readonly string _path;

    public FileLogger(string path)
      => _path = path;
    
    public void Log(string message)
      => File.AppendText(
          _path, 
          $"{Message: {message}{Environment.NewLine}"
        );
}

```

---


### Common Methods

| File Method | FileInfo Method |
|:------------|:----------------|
| [`File.Exists`](https://learn.microsoft.com/en-us/dotnet/api/system.io.file.exists) | [`FileInfo.Exists`](https://learn.microsoft.com/en-us/dotnet/api/system.io.fileinfo.exists) |
| [`File.ReadAllLines`](https://learn.microsoft.com/en-us/dotnet/api/system.io.file.readalllines) | [`FileInfo.ReadAllLines`](https://learn.microsoft.com/en-us/dotnet/api/system.io.fileinfo.readalllines) |
| [`File.Move`](https://learn.microsoft.com/en-us/dotnet/api/system.io.file.move) | [`FileInfo.MoveTo`](https://learn.microsoft.com/en-us/dotnet/api/system.io.fileinfo.moveto) |
| [`File.Delete`](https://learn.microsoft.com/en-us/dotnet/api/system.io.file.delete) | [`FileInfo.Delete`](https://learn.microsoft.com/en-us/dotnet/api/system.io.fileinfo.delete) |
| [`File.Create`](https://learn.microsoft.com/en-us/dotnet/api/system.io.file.create) | [`FileInfo.Create`](https://learn.microsoft.com/en-us/dotnet/api/system.io.fileinfo.create) |
| [`File.Copy`](https://learn.microsoft.com/en-us/dotnet/api/system.io.file.copy) | [`FileInfo.CopyTo`](https://learn.microsoft.com/en-us/dotnet/api/system.io.fileinfo.copyto) |
| [`File.GetCreationTime`](https://learn.microsoft.com/en-us/dotnet/api/system.io.file.getcreationtime) | [`FileInfo.CreationTime`](https://learn.microsoft.com/en-us/dotnet/api/system.io.fileinfo.creationtime) |
| [`File.GetFileSize`](https://learn.microsoft.com/en-us/dotnet/api/system.io.file.getfilesize) | [`FileInfo.Length`](https://learn.microsoft.com/en-us/dotnet/api/system.io.fileinfo.length) |

---



### Directories 
* Similar pattern to Files:
  - [`Directory`](https://learn.microsoft.com/en-us/dotnet/api/system.io.directory) has static methods
  - [`DirectoryInfo`](https://learn.microsoft.com/en-us/dotnet/api/system.io.directoryinfo) has instance methods
* Common operations:
  - Create/Delete directories
  - List contents
  - Move/Rename
  - Get creation/modification times

---

### Example: Create a directory

```csharp
// Static method
Directory.CreateDirectory("logs");

// Instance method
var dir = new DirectoryInfo("logs");
dir.Create();
```

---

### What's Blocking?

* File operations shown so far are [blocking operations](https://learn.microsoft.com/en-us/dotnet/standard/io/asynchronous-file-i-o)
* Blocking wastes [thread pool threads](https://learn.microsoft.com/en-us/dotnet/standard/threading/the-managed-thread-pool)
* Most application time is spent waiting for I/O
* [Asynchronous I/O](https://learn.microsoft.com/en-us/dotnet/standard/asynchronous-programming-patterns/) is better for scalability
* Easier to reason about synchronous code
* We'll explore async alternatives in more depth later

---


### Reading Lines

* [`File.ReadLines`](https://learn.microsoft.com/en-us/dotnet/api/system.io.file.readlines) returns lines lazily
* [`File.ReadAllLines`](https://learn.microsoft.com/en-us/dotnet/api/system.io.file.readalllines) reads all lines at once
* Use `ReadLines` for large files
* Use `ReadAllLines` for small files



---

### Example: Random Line

```csharp title="RandomLine.cs"
public string GetRandomLine(string filePath){
    var lines = File.ReadAllLines(filePath);
    var random = Random.Shared;
    var index = random.Next(lines.Length);
    return lines[index];
}
```

---




## Streams

---

### Motivation
* You *can* read entire files into memory:
  ```csharp
  var allText = File.ReadAllText("huge.log");
  ```
* Potential problems:
  - Spike memory usage
  - Can't start processing until entire file is read
  - No progress feedback
  - Limited by available memory


---

### What's a Stream?
* An abstract representation of sequential data
* Base class: [`System.IO.Stream`](https://learn.microsoft.com/en-us/dotnet/api/system.io.stream)
* Key characteristics:
  - Read/write in chunks
  - Can seek (move position) in some streams
  - Can be chained together (e.g., compression + encryption)

---

### Common Streams
* [`FileStream`](https://learn.microsoft.com/en-us/dotnet/api/system.io.filestream) for files
* [`MemoryStream`](https://learn.microsoft.com/en-us/dotnet/api/system.io.memorystream) for in-memory data
* [`NetworkStream`](https://learn.microsoft.com/en-us/dotnet/api/system.net.sockets.networkstream) for network data

---

### Example: Copy Directory Contents

```csharp
    private static async void DoCopy(){
        var sourceD = @"c:\Users\exampleuser\start";
        var destD = @"c:\Users\exampleuser\end";

        foreach (var path in Directory.EnumerateFiles(sourceD)){
            var source = File.Open(path, FileMode.Open);
            var dest = File.Create(destD
                + path.Substring(path.LastIndexOf('\\')
            ));

            source.CopyTo(dest);
            source.Close();
            dest.Close();
        }
    }

```

---

### Complaints

* Code is still blocking despite async signature
* Potential resource leaks if exceptions occur
* We'll address both issues in upcoming sections

---

### Example: Chain Streams
```csharp
using var file = File.OpenRead("data.gz");
using var gzip = new GZipStream(file, CompressionMode.Decompress);
using var reader = new StreamReader(gzip);
var data = reader.ReadToEnd();
```

---

### Managing Resources
* Streams 
  - **Ususally** hold on to resources that aren't garbage collected
  - **Always** implement [`IDisposable`](https://learn.microsoft.com/en-us/dotnet/api/system.idisposable)
* You should ***always*** close streams when done
  - Leverage keyword [`using`](https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/using) for automatic cleanup
  - Details discussed elsewhere


---



## [HttpClient](https://learn.microsoft.com/en-us/dotnet/api/system.net.http.httpclient)

---

### History
* `HttpClient` was introduced in .NET 4.5
* Prior to that, people used `WebClient`
* `WebClient` is now obsolete

---

### HttpClient
* `System.Net.Http` namespace
* Base class: [`System.Net.Http.HttpClient`](https://learn.microsoft.com/en-us/dotnet/api/system.net.http.httpclient)
* Key characteristics:
  - Asynchronous operations
  - Automatic resource management
  - Built-in caching
  - Handles cookies

---

### Example: Basic Usage

```csharp title="IsUpChecker.cs"
public bool IsUp(string url){
    try{
        var client = new HttpClient();
        client.Timeout = TimeSpan.FromSeconds(5);
        var response = client.GetAsync(url).Result;
        bool isSuccess = response.IsSuccessStatusCode;
        client.Dispose();
        return isSuccess;
    }
    catch (Exception){
        return false;
    }
}
```

---

### Reminder: REST
* REST is a style of web service
* Key characteristics:
  - Stateless
  - Cacheable
  - Layered
  - Uniform interface
  - Client-server

---

### Http Methods

* [GET](https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods/GET) - Retrieve data
* [POST](https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods/POST) - Create new resource
* [PUT](https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods/PUT) - Update existing resource
* [DELETE](https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods/DELETE) - Remove resource
* Other methods include PATCH, HEAD, OPTIONS, and more

---


## Fin

---


### Review

1. Explain the difference between `File` and `FileInfo`
2. Explain the difference between `Directory` and `DirectoryInfo`
2. Describe the benefits of using streams to process files
4. Describe how to make HTTP requests using `HttpClient` (Optional)
